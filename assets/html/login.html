<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>Ecolink - Sistema de Gest√£o de Res√≠duos</title>
    <link rel="stylesheet" href="../css/login.css" />
    
  </head>

  <body>
    <a
      class="back-home"
      href="../../index.html"
      title="Voltar para a Home"
      aria-label="Voltar para a Home"
    >
      <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
        <path d="M3 12l9-8 9 8" fill="none" stroke="currentColor" stroke-width="2" />
        <path d="M5 10v10h5v-6h4v6h5V10" fill="none" stroke="currentColor" stroke-width="2" />
      </svg>
    </a>

    <!-- Header -->
    <header class="header-container">
      
      <!-- √Årea din√¢mica ao logar: notifica√ß√µes + sair -->
      <div class="user-actions">
        <div class="notif-wrap" id="notifWrap" style="display:none">
          <button class="btn btn-info" id="notifBtn" onclick="toggleNotifications()" aria-haspopup="true" aria-expanded="false">
            üîî Notifica√ß√µes <span class="badge-count" id="notifCount" hidden>0</span>
          </button>
          <div class="notif-dropdown" id="notifDropdown" hidden>
            <ul class="notif-list" id="notifList"></ul>
            <div class="notif-footer">
              <button class="btn btn-warning" onclick="clearAllNotifications()">Limpar</button>
            </div>
          </div>
        </div>

        <button class="btn btn-danger" id="logoutBtn" onclick="logout()" style="display:none">Sair</button>
      </div>
    </header>

    <div class="container">
      <div class="form-logo">
        <img src="../imgs/logo.png" alt="Logomarca da Ecolink" />
      </div>
      <nav class="nav-tabs" id="authTabs" role="tablist" aria-label="Abas principais">
        <button
          class="nav-tab active"
          id="loginTab"
          onclick="showScreen('login', event)"
          aria-controls="login"
          aria-selected="true"
        >
          Login
        </button>
        <button
          class="nav-tab"
          id="registerTab"
          onclick="showScreen('register', event)"
          aria-controls="register"
          aria-selected="false"
        >
          Cadastro
        </button>
      </nav>

      <main class="content">
        <!-- LOGIN -->
        <section id="login" class="screen active" aria-labelledby="login-title">
          <h2 id="login-title" class="section-title">Acesse sua conta</h2>
          <form id="loginForm" onsubmit="handleLogin(event)" autocomplete="off">
            <div class="form-group">
              <label for="loginUser">Usu√°rio</label>
              <input type="text" id="loginUser" required />
            </div>
            <div class="form-group">
              <label for="loginPassword">Senha</label>
              <input type="password" id="loginPassword" required />
            </div>
            <button type="submit" class="btn btn-primary">Entrar</button>
          </form>
        </section>

        <!-- CADASTRO -->
        <section id="register" class="screen" aria-labelledby="register-title">
          <h2 id="register-title" class="section-title">Novo Cadastro</h2>

          <h3 class="subsection-title">Selecione o tipo de usu√°rio</h3>
          <div class="tier-selector">
            <div class="tier-card" onclick="selectUserType('doador', event)" role="button" tabindex="0">
              <div class="tier-icon">üì¶</div>
              <h3>Doador</h3>
              <p>Empresas que descartam res√≠duos t√™xteis</p>
            </div>
            <div class="tier-card" onclick="selectUserType('recebedor', event)" role="button" tabindex="0">
              <div class="tier-icon">‚ôªÔ∏è</div>
              <h3>Recebedor</h3>
              <p>Empresas que recebem e processam res√≠duos</p>
            </div>
            <div class="tier-card" onclick="selectUserType('transportador', event)" role="button" tabindex="0">
              <div class="tier-icon">üöö</div>
              <h3>Transportador</h3>
              <p>Empresas que realizam o transporte</p>
            </div>
          </div>

          <!-- Subtipo de transporte -->
          <div id="transportTypeSelection" style="display: none">
            <h3 class="subsection-title">Selecione o tipo de transporte</h3>
            <div class="tier-selector">
              <div class="tier-card transport-type" onclick="selectTransportType('moto', event)">
                <div class="tier-icon">üèçÔ∏è</div>
                <h3>Moto</h3>
                <p>Entregas r√°pidas e √°geis</p>
              </div>
              <div class="tier-card transport-type" onclick="selectTransportType('carro', event)">
                <div class="tier-icon">üöó</div>
                <h3>Carro</h3>
                <p>M√©dio porte</p>
              </div>
              <div class="tier-card transport-type" onclick="selectTransportType('caminhao', event)">
                <div class="tier-icon">üöõ</div>
                <h3>Caminh√£o</h3>
                <p>Grande capacidade</p>
              </div>
            </div>
          </div>

          <!-- PLANOS -->
          <div id="tierSelection" style="display: none">
            <h3 class="subsection-title">Selecione o plano</h3>
            <div class="tier-selector" id="planCards"></div>

            <h3 class="subsection-title" style="margin-top: 20px">Periodicidade do Pagamento</h3>
            <div class="form-group">
              <select id="planPeriodicity" onchange="updatePlanPriceDisplay()" required>
                <option value="mensal">Mensal</option>
                <option value="trimestral">Trimestral (5% de Desconto)</option>
                <option value="semestral">Semestral (10% de Desconto)</option>
                <option value="anual">Anual (15% de Desconto)</option>
              </select>
            </div>
          </div>

          <!-- FORMUL√ÅRIO DE CADASTRO -->
          <form id="registerForm" style="display: none" onsubmit="handleRegister(event)" autocomplete="on" novalidate>
            <div class="form-row">
              <div class="form-group">
                <label for="regName">Nome Completo / Raz√£o Social</label>
                <input type="text" id="regName" required />
              </div>
              <div class="form-group">
                <label for="regDoc">CPF / CNPJ</label>
                <input type="text" id="regDoc" required />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="regEmail">Email</label>
                <input type="email" id="regEmail" required />
              </div>
              <div class="form-group">
                <label for="regPhone">Telefone</label>
                <input type="tel" id="regPhone" required />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="regUsername">Nome de Usu√°rio</label>
                <input type="text" id="regUsername" required />
              </div>
              <div class="form-group">
                <label for="regPassword">Senha</label>
                <input type="password" id="regPassword" required oninput="checkPasswordStrength(this.value)" />
                <div id="passwordStrength" class="password-strength"></div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="regCep">CEP</label>
                <input
                  type="text"
                  id="regCep"
                  required
                  maxlength="9"
                  placeholder="00000-000"
                  onblur="buscarCep('reg', this.value)"
                />
                <span id="regCepLoading" class="loading" style="display: none">Buscando CEP...</span>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="regLogradouro">Logradouro</label>
                <input type="text" id="regLogradouro" required />
              </div>
              <div class="form-group">
                <label for="regNumero">N√∫mero</label>
                <input type="text" id="regNumero" required />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="regComplemento">Complemento</label>
                <input type="text" id="regComplemento" />
              </div>
              <div class="form-group">
                <label for="regBairro">Bairro</label>
                <input type="text" id="regBairro" required />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="regCidade">Cidade</label>
                <input type="text" id="regCidade" required />
              </div>
              <div class="form-group">
                <label for="regEstado">Estado (UF)</label>
                <input type="text" id="regEstado" required maxlength="2" />
              </div>
            </div>

            <!-- Campos de ve√≠culo/CNH (transportador) -->
            <fieldset id="vehicleFields" style="display: none; margin-top: 20px">
              <legend>Dados do Ve√≠culo</legend>
              <div class="form-row">
                <div class="form-group">
                  <label for="vehicleRenavam">RENAVAM</label>
                  <input type="text" id="vehicleRenavam" maxlength="11" />
                </div>
                <div class="form-group">
                  <label for="vehiclePlaca">Placa</label>
                  <input type="text" id="vehiclePlaca" maxlength="7" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="vehicleModelo">Modelo</label>
                  <input type="text" id="vehicleModelo" />
                </div>
                <div class="form-group">
                  <label for="vehicleAno">Ano</label>
                  <input type="number" id="vehicleAno" maxlength="4" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="vehicleCor">Cor</label>
                  <input type="text" id="vehicleCor" />
                </div>
                <div class="form-group">
                  <label for="freightRate">Tarifa de Frete (R$/km)</label>
                  <input type="number" id="freightRate" step="0.01" min="0.10" />
                </div>
              </div>
            </fieldset>

            <fieldset id="cnhFields" style="display: none; margin-top: 20px">
              <legend>Dados da CNH</legend>
              <div class="form-row">
                <div class="form-group">
                  <label for="cnhNumero">N√∫mero de Registro</label>
                  <input type="text" id="cnhNumero" />
                </div>
                <div class="form-group">
                  <label for="cnhCategoria">Categoria</label>
                  <select id="cnhCategoria">
                    <option value="">Selecione</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                    <option value="E">E</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="cnhValidade">Data de Validade</label>
                  <input type="date" id="cnhValidade" />
                </div>
              </div>
            </fieldset>

            <!-- PAGAMENTO DO PLANO -->
            <fieldset id="paymentSection" style="display: none; margin-top: 20px">
              <legend>Pagamento do Plano</legend>

              <div id="planSummary" class="tier-summary" style="display: none">
                <span id="planSummaryText" style="flex: 1"></span>
                <span id="planSummaryTotal" style="font-weight: 800; font-size: 1.1em; color: var(--primary-green)"></span>
              </div>

              <h4 class="subsection-title" style="margin-top: 0">Selecione o M√©todo de Pagamento</h4>
              <div class="payment-method-selector">
                <label class="radio-label">
                  <input type="radio" name="paymentMethod" value="pix" onchange="showPaymentFields('plan', 'pix')" />
                  <span class="icon-label"><span class="icon">üì±</span> PIX</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="paymentMethod" value="transfer" onchange="showPaymentFields('plan', 'transfer')" />
                  <span class="icon-label"><span class="icon">üè¶</span> Transfer√™ncia Banc√°ria</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="paymentMethod" value="debit" onchange="showPaymentFields('plan', 'debit')" />
                  <span class="icon-label"><span class="icon">üí≥</span> Cart√£o de D√©bito</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="paymentMethod" value="credit" onchange="showPaymentFields('plan', 'credit')" />
                  <span class="icon-label"><span class="icon">üí≥</span> Cart√£o de Cr√©dito</span>
                </label>
              </div>

              <div id="planPixDetails" class="payment-details" style="display: none">
                <p><strong>Chave PIX (CNPJ):</strong> 00.000.000/0001-00</p>
                <p style="font-size: 0.9em; color: var(--danger)">O cadastro s√≥ ser√° finalizado ap√≥s a confirma√ß√£o do pagamento.</p>
              </div>

              <div id="planTransferDetails" class="payment-details" style="display: none">
                <p><strong>Banco:</strong> 001 - Banco do Brasil</p>
                <p><strong>Ag√™ncia:</strong> 1234-5</p>
                <p><strong>Conta:</strong> 67890-0 (Pessoa Jur√≠dica)</p>
                <p style="font-size: 0.9em; color: var(--danger)">O cadastro s√≥ ser√° finalizado ap√≥s a confirma√ß√£o do pagamento.</p>
              </div>

              <div id="planCardDetails" class="payment-details card-details" style="display: none">
                <div class="form-group">
                  <label for="planCardNumber">N√∫mero do Cart√£o</label>
                  <input type="text" id="planCardNumber" maxlength="19" placeholder="0000 0000 0000 0000" oninput="formatCardNumber(this)" />
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="planCardName">Nome no Cart√£o</label>
                    <input type="text" id="planCardName" placeholder="Como est√° no cart√£o" />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="planCardExpiry">Validade</label>
                    <input type="text" id="planCardExpiry" maxlength="5" placeholder="MM/AA" oninput="formatExpiry(this)" />
                  </div>
                  <div class="form-group">
                    <label for="planCardCvv">CVV</label>
                    <input type="text" id="planCardCvv" maxlength="4" placeholder="123" />
                  </div>
                </div>
              </div>
            </fieldset>

            <button class="btn btn-primary" type="submit" id="regSubmitBtn" style="margin-top: 1.5rem">
              Finalizar Cadastro e Pagar
            </button>
          </form>
        </section>

        <!-- DASHBOARD -->
        <section id="dashboard" class="screen" aria-labelledby="dashboard-title">
          <h2 id="dashboard-title" class="section-title">Dashboard</h2>
          <p><strong id="userName"></strong></p>
          <p id="userType"></p>

          <!-- Doador -->
          <div id="doadorDash" style="display: none">
            <h3 class="section-title">Painel do Doador</h3>
            <div class="dashboard">
              <div class="stat-card green">
                <div class="stat-value" id="co2Saved">0</div>
                <div class="stat-label">kg de CO¬≤ evitados</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="waterSaved">0</div>
                <div class="stat-label">Litros de √°gua poupados</div>
              </div>
              <div class="stat-card green">
                <div class="stat-value" id="landfillSaved">0</div>
                <div class="stat-label">kg de res√≠duos desviados</div>
              </div>
            </div>

            <button class="btn btn-primary" onclick="openModal('newDonationModal')">Registrar Nova Doa√ß√£o</button>

            <h3 class="table-title">Minhas Doa√ß√µes Recentes</h3>
            <div class="table-container">
              <table id="donorDonationsTable">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Tipo</th>
                    <th>Peso (kg)</th>
                    <th>Data</th>
                    <th>Status</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <h3 class="table-title">Notifica√ß√µes</h3>
            <div id="donorNotifications" class="notifications"></div>
          </div>

          <!-- Recebedor -->
          <div id="recebedorDash" style="display: none">
            <h3 class="table-title">Doa√ß√µes Dispon√≠veis</h3>
            <div id="receiverNotifications" class="notifications"></div>
            <div class="table-container">
              <table id="availableDonationsTable">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Categoria</th>
                    <th>Peso (kg)</th>
                    <th>Data</th>
                    <th>Status</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <!-- Transportador -->
          <div id="transportadorDash" style="display: none">
            <h3 class="table-title">Coletas Dispon√≠veis</h3>
            <div id="transportNotifications" class="notifications"></div>
            <div class="table-container">
              <table id="availablePickupsTable">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Doador (Coleta)</th>
                    <th>Recebedor (Entrega)</th>
                    <th>Peso (kg)</th>
                    <th>Status</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- MODAL RASTREAMENTO -->
    <div id="trackingModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="tracking-title">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('trackingModal')">&times;</span>
        <h2 id="tracking-title" class="section-title">Rastreamento da Doa√ß√£o</h2>
        <div id="trackingBody"></div>
      </div>
    </div>

    <div class="toast hidden" id="toast">Notifica√ß√£o aqui</div>

    <script src="../js/script.js"></script>

    <script>
      
        const hash = window.location.hash.substring(1);
        if (hash === "register") {
          showScreen(hash);
        } else {
          showScreen("login");
        }
    </script>
  </body>
</html>
